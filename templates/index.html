<!DOCTYPE html>
<html>
<head>
    <title>AI Resume Helper</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #ffdde1, #ffe4ec);
            color: #333;
        }
        h1 { text-align: center; padding: 20px; color: #444; }
        .container {
            max-width: 850px;
            margin: auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            margin-bottom: 50px;
        }
        textarea, input[type="file"] {
            width: 100%; margin: 10px 0; padding: 12px;
            border: 1px solid #ccc; border-radius: 8px;
            transition: 0.3s;
        }
        textarea:focus, input[type="file"]:focus {
            border-color: #ff99aa;
            box-shadow: 0 0 5px rgba(255,153,170,0.5);
            outline: none;
        }
        button {
            padding: 12px 20px; border: none; border-radius: 8px;
            background: #ff99aa; color: white;
            font-size: 15px; font-weight: bold;
            cursor: pointer; transition: 0.3s;
        }
        button:hover {
            background: #ff7f95; transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .feedback-btns { display: flex; gap: 10px; margin-top: 5px; }
        .feedback-btns button:first-child { background: #28a745; }
        .feedback-btns button:first-child:hover { background: #218838; }
        .feedback-btns button:last-child { background: #dc3545; }
        .feedback-btns button:last-child:hover { background: #c82333; }
        pre {
            background: #f8f9fa; padding: 12px; border-radius: 8px;
            white-space: pre-wrap; border: 1px solid #ddd;
            margin-top: 10px; max-height: 300px; overflow-y: auto;
        }
        h3 { margin-top: 20px; color: #444; }
    </style>
</head>
<body>
    <h1>üíº AI Resume Helper</h1>
    <div class="container">
        <h3>1Ô∏è‚É£ Upload Resume</h3>
        <input type="file" id="resumeFile">

        <h3>2Ô∏è‚É£ Paste Job Description (Optional)</h3>
        <textarea id="jobDesc" placeholder="Paste job description here..."></textarea>

        <h3>3Ô∏è‚É£ Actions</h3>
        <button onclick="summarizeResume()">üìú Summarize Resume</button>
        <button onclick="checkATS()">üìä Check ATS Score</button>

        <h3>üìÑ Output</h3>
        <pre id="output"></pre>

        <h3>4Ô∏è‚É£ Feedback</h3>
        <div class="feedback-btns">
            <button onclick="sendFeedback('approve')">üëç Approve</button>
            <button onclick="sendFeedback('reject')">üëé Reject</button>
        </div>

        <h3>5Ô∏è‚É£ Export Improved Resume</h3>
        <button onclick="exportResume()">üì• Download PDF</button>
    </div>

    <script>
        let lastSuggestion = "";

        async function summarizeResume() {
            const fileInput = document.getElementById("resumeFile").files[0];
            if (!fileInput) return alert("Please upload a resume");

            const formData = new FormData();
            formData.append("file", fileInput);

            const res = await fetch("/summarize_resume/", {
                method: "POST",
                body: formData
            });
            const data = await res.json();
            document.getElementById("output").innerText = data.summary;
            lastSuggestion = data.summary;
        }

        async function checkATS() {
            const fileInput = document.getElementById("resumeFile").files[0];
            const jobDesc = document.getElementById("jobDesc").value;
            if (!fileInput || !jobDesc) return alert("Upload resume and paste job description");

            const formData = new FormData();
            formData.append("file", fileInput);
            formData.append("job_desc", jobDesc);

            const res = await fetch("/match_resume/?job_desc=" + encodeURIComponent(jobDesc), {
                method: "POST",
                body: formData
            });
            const data = await res.json();
            document.getElementById("output").innerText = data.match_result;
            lastSuggestion = data.match_result;
        }

        async function sendFeedback(decision) {
            if (!lastSuggestion) return alert("No suggestion to give feedback on");
            const res = await fetch("/feedback/", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `suggestion=${encodeURIComponent(lastSuggestion)}&decision=${decision}`
            });
            alert("Feedback saved!");
        }

        async function exportResume() {
            if (!lastSuggestion) return alert("No resume content to export");
            const res = await fetch("/export_resume/", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `bullets=${encodeURIComponent(lastSuggestion)}`
            });
            alert("Resume PDF exported to server folder!");
        }
    </script>
</body>
</html>
